<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Detailed beer recipe and brewing information for Ostentatious Brewing">
    <title>Beer Details - OSTENTATIOUS BREWING</title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/base.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/footer.css">
    <link rel="stylesheet" href="/assets/css/beer-detail.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Overpass:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <img src="/assets/images/logo/ostentatious-brewing.png"
                 alt="Ostentatious Brewing Logo"
                 class="logo"
                 loading="lazy">
        </div>

        <div>
            <h1 class="header_text">OSTENTATIOUS BREWING</h1>
        </div>

        <button class="hamburger"
                onclick="toggleMenu()"
                aria-label="Toggle navigation menu"
                aria-expanded="false">
            â˜°
        </button>

        <!-- Navigation -->
        <nav role="navigation" aria-label="Main navigation">
            <ul>
                <li><a href="/index.html">HOME</a></li>
                <li><a href="/about.html">ABOUT</a></li>
                <li><a href="/on-tap.html">ON TAP</a></li>
                <li><a href="/in-production.html">IN PRODUCTION</a></li>
                <li><a href="/past-beers.html">PAST BEERS</a></li>
                <li><a href="/brew-setup.html">BREW SETUP</a></li>
                <li><a href="/cellar.html">CELLAR</a></li>
                <li><a href="https://github.com/austinshinkle" target="_blank" rel="noopener">GITHUB</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div id="beer-container" class="container" role="main">
            <!-- Content will be dynamically populated -->
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Ostentatious Brewing</p>
            <a href="https://www.instagram.com/ostentatiousbrewmaster"
               target="_blank"
               rel="noopener"
               aria-label="Follow us on Instagram">
                <img src="/assets/images/icons/instagram-icon.png"
                     alt="Instagram"
                     class="instagram-logo"
                     loading="lazy">
            </a>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Navigation toggle functionality
        function toggleMenu() {
            const nav = document.querySelector("nav");
            const hamburger = document.querySelector(".hamburger");
            const isOpen = nav.classList.contains("nav-open");

            nav.classList.toggle("nav-open");
            hamburger.setAttribute("aria-expanded", !isOpen);
        }

        // Close mobile menu on resize
        window.addEventListener("resize", () => {
            const nav = document.querySelector("nav");
            const hamburger = document.querySelector(".hamburger");

            if (window.innerWidth > 1024 && nav.classList.contains("nav-open")) {
                nav.classList.remove("nav-open");
                hamburger.setAttribute("aria-expanded", "false");
            }
        });

        // Beer data loading and page population
        class BeerPageBuilder {
            constructor(containerSelector, dataUrl) {
                this.container = document.querySelector(containerSelector);
                this.dataUrl = dataUrl;
                this.beerData = null;
            }

            async loadBeerData() {
                try {
                    const response = await fetch(this.dataUrl);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    this.beerData = await response.json();
                    console.log("Loaded Beer Data:", this.beerData);
                } catch (error) {
                    console.error("Error loading beer JSON:", error);
                    this.showErrorMessage();
                    return false;
                }
                return true;
            }

            showErrorMessage() {
                this.container.innerHTML = `
                    <div class="error-message">
                        <h2>Unable to load beer data</h2>
                        <p>Please try refreshing the page or contact support.</p>
                    </div>
                `;
            }

            createElement(tag, className = '', textContent = '') {
                const element = document.createElement(tag);
                if (className) element.className = className;
                if (textContent) element.textContent = textContent;
                return element;
            }

            createBackButton() {
                const backLink = this.createElement('button', 'back-button', '<< BEERS');
                backLink.addEventListener('click', () => window.history.back());
                backLink.setAttribute('aria-label', 'Go back to beer list');
                return backLink;
            }

            createBeerHeader() {
                const fragment = document.createDocumentFragment();

                // Back button
                fragment.appendChild(this.createBackButton());

                // Title container
                const titleContainer = this.createElement('div', 'beer-title-container');
                const title = this.createElement('h1', 'beer-title', this.beerData.name);
                const style = this.createElement('h2', 'beer-style', this.beerData.style);

                titleContainer.appendChild(title);
                titleContainer.appendChild(style);
                fragment.appendChild(titleContainer);

                // Description
                const description = this.createElement('p', 'beer-page-description', this.beerData.description);
                fragment.appendChild(description);

                return fragment;
            }

            createStatsTable() {
                const stats = this.beerData.beer_statistics[0];
                const statsFields = [
                    ['Target OG', stats.target_og],
                    ['Target FG', stats.target_fg],
                    ['Target ABV', stats.target_abv],
                    ['Actual OG', stats.actual_og],
                    ['Actual FG', stats.actual_fg],
                    ['Actual ABV', stats.actual_abv],
                    ['Calc IBU', stats.calculated_ibu],
                    ['Calc SRM', stats.calculated_srm],
                    ['Cost', stats.cost]
                ];

                const table = this.createElement('table', 'beer-stats-grid');
                let row;

                statsFields.forEach(([label, value], index) => {
                    if (index % 3 === 0) {
                        row = document.createElement('tr');
                        table.appendChild(row);
                    }

                    const cell = document.createElement('td');
                    cell.innerHTML = `
                        <span class="beer-stat-title">${label}</span>
                        <span class="beer-stat-value">${value || 'N/A'}</span>
                    `;
                    row.appendChild(cell);
                });

                return table;
            }

            createImageStatsSection() {
                const container = this.createElement('div', 'image-stats-container');

                // Beer image
                const image = document.createElement('img');
                image.className = 'beer-page-image';
                image.src = this.beerData.logo;
                image.alt = `${this.beerData.name} beer logo`;
                image.loading = 'lazy';
                container.appendChild(image);

                // Stats section
                const statsSection = this.createElement('div');
                const statsTitle = this.createElement('h3', 'section-title', 'Beer Statistics');
                const statsTable = this.createStatsTable();

                statsSection.appendChild(statsTitle);
                statsSection.appendChild(statsTable);
                container.appendChild(statsSection);

                return container;
            }

            createDetailsSection() {
                const container = this.createElement('div', 'beer-details');

                // Ingredients
                const ingredientsColumn = this.createIngredientsColumn();
                container.appendChild(ingredientsColumn);

                // Yeast Starter
                const starterColumn = this.createInstructionsColumn(
                    'Yeast Starter Instructions',
                    this.beerData.starter_brewing_instructions
                );
                container.appendChild(starterColumn);

                // Brewing Instructions
                const brewingColumn = this.createInstructionsColumn(
                    'Brewing Instructions',
                    this.beerData.brewing_instructions
                );
                container.appendChild(brewingColumn);

                return container;
            }

            createIngredientsColumn() {
                const column = this.createElement('div', 'beer-column');
                const title = this.createElement('h3', 'section-title', 'Ingredients List');
                column.appendChild(title);

                const list = this.createElement('div', 'ingredients-list');

                Object.entries(this.beerData.ingredients).forEach(([type, ingredients]) => {
                    ingredients.forEach(ingredient => {
                        const item = this.createElement('div', 'ingredients-list-item', ingredient);
                        list.appendChild(item);
                    });
                });

                column.appendChild(list);
                return column;
            }

            createInstructionsColumn(title, instructions) {
                const column = this.createElement('div', 'beer-column');
                const titleElement = this.createElement('h3', 'section-title', title);
                column.appendChild(titleElement);

                instructions.forEach(instruction => {
                    const item = this.createElement('div', 'ingredients-list-item', instruction);
                    column.appendChild(item);
                });

                return column;
            }

            createChart(canvasId, title, data, dataLabel, yAxisLabel) {
                const titleElement = this.createElement('h3', 'section-title', title);
                const canvas = document.createElement('canvas');
                canvas.id = canvasId;

                this.container.appendChild(titleElement);
                this.container.appendChild(canvas);

                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: dataLabel,
                            data: data,
                            borderColor: 'rgba(85, 85, 85, 1)',
                            borderWidth: 2,
                            fill: canvasId === 'fermentation-data',
                            tension: canvasId === 'fermentation-profile' ? 0.3 : 0.1,
                            stepped: canvasId === 'fermentation-profile'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                title: { display: true, text: 'Day' },
                                ticks: { stepSize: 1 }
                            },
                            y: {
                                beginAtZero: false,
                                title: { display: true, text: yAxisLabel }
                            }
                        }
                    }
                });
            }

            async render() {
                const success = await this.loadBeerData();
                if (!success) return;

                // Clear container
                this.container.innerHTML = '';

                // Build page sections
                this.container.appendChild(this.createBeerHeader());
                this.container.appendChild(this.createImageStatsSection());

                const hr = this.createElement('hr', 'horizontal-line');
                this.container.appendChild(hr);

                this.container.appendChild(this.createDetailsSection());

                // Create charts
                const tempData = this.beerData.fermentation_profile.map(entry => ({
                    x: entry.day,
                    y: entry.temp
                }));

                const sgData = this.beerData.fermentation_data.map(entry => ({
                    x: entry.day,
                    y: entry.SG
                }));

                this.createChart(
                    'fermentation-profile',
                    'Fermentation Temperature Profile',
                    tempData,
                    'Fermentation Temp (Â°F)',
                    'Temperature (Â°F)'
                );

                this.createChart(
                    'fermentation-data',
                    'Fermentation Specific Gravity Data',
                    sgData,
                    'Actual Specific Gravity',
                    'Specific Gravity'
                );
            }
        }

        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const beerPage = new BeerPageBuilder('#beer-container', '/assets/data/recipes/sommerbock.json');
            beerPage.render();
        });
    </script>
</body>
</html>
